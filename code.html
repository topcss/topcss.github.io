<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AirScan Pro | é«˜é€Ÿç¦»çº¿ä¼ è¾“</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        
        /* äºŒç»´ç çŸ©é˜µæ ·å¼ */
        .qr-matrix { 
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; 
            width: 100%; aspect-ratio: 1/1; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: zoom-in;
        }
        .qr-cell { width: 100%; height: 100%; image-rendering: pixelated; border-radius: 8px; border: 1px solid #f1f5f9; background: white; }
        
        /* å…¨å±æ”¾å¤§æ ·å¼ */
        .matrix-fullscreen { 
            position: fixed !important; 
            top: 0 !important; 
            left: 0 !important; 
            width: 100vw !important; 
            height: 100vh !important; 
            z-index: 200 !important; 
            background: white !important; 
            cursor: zoom-out;
            
            /* æ ¸å¿ƒä¿®å¤ï¼šç¡®ä¿å®Œç¾å±…ä¸­ */
            /* display: flex !important; */
            align-items: center !important; 
            justify-content: center !important;
            padding: 100px !important;
            margin: -40px 0;
        }

        .matrix-fullscreen .qr-matrix { 
            gap: 15px; 
            /* ç¡®ä¿åœ¨å®½å±å’Œç«–å±ä¸‹éƒ½èƒ½ä»¥æœ€å°è¾¹ä¸ºåŸºå‡†å±…ä¸­ */
            width: min(90vw, 85vh) !important; 
            height: min(90vw, 85vh) !important;
            aspect-ratio: 1/1 !important;
            margin: 0 !important; /* æ¸…é™¤ä¹‹å‰å¯èƒ½å¹²æ‰°çš„ margin */
        }

        .preview-box { width: 100%; aspect-ratio: 1/1; position: relative; background: #000; border-radius: 24px; overflow: hidden; }
        #rv { width: 100%; height: 100%; object-fit: cover; }
        .scanning-line { height: 2px; background: linear-gradient(90deg, transparent, #6366f1, transparent); width: 100%; position: absolute; top: 0; animation: scan 3s linear infinite; }
        @keyframes scan { from { top: 0%; } to { top: 100%; } }
        .tab-active { background: #6366f1; color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        
        /* æç¤ºå±‚ */
        .hint-overlay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 6px 14px; border-radius: 20px; font-size: 10px; pointer-events: none; z-index: 210; opacity: 0; transition: opacity 0.3s; }
        .matrix-fullscreen .hint-overlay { opacity: 1; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

<header class="bg-white/80 sticky top-0 z-[100] border-b border-slate-100 px-6 py-4 flex justify-between items-center glass">
    <h1 class="text-xl font-black italic text-indigo-600">AirScan <span class="text-slate-400 not-italic font-light text-xs">ULTIMATE</span></h1>
    <div class="flex bg-slate-100 p-1 rounded-2xl w-40">
        <button onclick="app.switchTab('send')" id="tab-s" class="flex-1 py-1.5 rounded-xl text-xs font-bold transition-all tab-active">å‘é€</button>
        <button onclick="app.switchTab('receive')" id="tab-r" class="flex-1 py-1.5 rounded-xl text-xs font-bold transition-all text-slate-500">æ¥æ”¶</button>
    </div>
</header>

<main id="panel-send" class="flex-1 p-6 flex flex-col max-w-md mx-auto w-full">
    <div class="bg-white rounded-3xl p-5 shadow-sm border border-slate-100 mb-6">
        <div class="flex gap-4 mb-4 border-b border-slate-50 pb-2">
            <button onclick="sender.toggleMode('file')" id="m-file" class="text-xs font-black text-indigo-600 border-b-2 border-indigo-600 pb-2">æ–‡ä»¶æ¨¡å¼</button>
            <button onclick="sender.toggleMode('text')" id="m-text" class="text-xs font-black text-slate-400 pb-2">çº¯æ–‡æœ¬</button>
        </div>
        
        <div id="area-file">
            <div onclick="document.getElementById('fi').click()" class="bg-slate-50 rounded-2xl py-8 border-2 border-dashed border-slate-200 flex flex-col items-center justify-center gap-2 cursor-pointer active:scale-95 transition-transform">
                <span class="text-2xl">ğŸ“¤</span>
                <span class="text-[11px] font-bold text-slate-500 uppercase tracking-widest">é€‰æ‹©æ–‡ä»¶</span>
                <input type="file" id="fi" class="hidden" onchange="sender.handleFile(this.files[0])">
            </div>
        </div>

        <div id="area-text" class="hidden">
            <textarea id="ti" class="w-full bg-slate-50 p-4 rounded-2xl text-sm outline-none border border-slate-100 h-24 mb-2" placeholder="è¾“å…¥å†…å®¹..."></textarea>
            <button onclick="sender.handleText()" class="w-full bg-indigo-600 text-white py-3 rounded-xl text-xs font-black">ç”Ÿæˆ</button>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-4">
            <div>
                <label class="text-[12px] text-slate-400 font-bold block mb-1 uppercase">å¸§ç‡ (FPS: <span id="v-fps">10</span>)</label>
                <input type="range" min="1" max="30" value="10" oninput="sender.fps=this.value;document.getElementById('v-fps').innerText=this.value" class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-indigo-600">
            </div>
            <div>
                <label class="text-[12px] text-slate-400 font-bold block mb-1 uppercase">å®¹é‡ (Size: <span id="v-cs">180</span>)</label>
                <input type="range" min="50" max="500" value="180" oninput="sender.cS=parseInt(this.value);document.getElementById('v-cs').innerText=this.value" class="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-indigo-600">
            </div>
        </div>
    </div>

    <div id="mc-container" class="relative flex-1 flex flex-col items-center justify-center">
        <div id="mc" class="qr-matrix opacity-10 grayscale blur-[2px]" onclick="app.toggleFullscreen()">
            <canvas id="qr1" class="qr-cell"></canvas><canvas id="qr2" class="qr-cell"></canvas>
            <canvas id="qr3" class="qr-cell"></canvas><canvas id="qr4" class="qr-cell"></canvas>
        </div>
        
        <div id="sender-ctrl" class="absolute inset-0 flex items-center justify-center z-50">
            <button id="bs" disabled onclick="sender.start()" class="bg-indigo-600 text-white px-10 py-4 rounded-[2rem] font-black shadow-xl disabled:bg-slate-200 active:scale-95 transition-all">å¼€å§‹å¹¿æ’­</button>
        </div>

        <div id="si" class="hidden mt-6 w-full bg-white p-4 rounded-2xl flex items-center shadow-sm border border-slate-100">
            <div class="flex-1 min-w-0 pr-4">
                <p id="sn" class="text-xs font-black truncate text-slate-800"></p>
                <p id="ss" class="text-[10px] text-indigo-500 font-mono"></p>
            </div>
            <button onclick="sender.stop()" id="btn-stop" class="hidden bg-red-50 text-red-500 px-4 py-2 rounded-xl text-[10px] font-black mr-2">åœæ­¢</button>
            <button onclick="sender.reset()" id="btn-reset" class="text-slate-300 px-2 text-xl">âœ•</button>
        </div>
    </div>
</main>

<main id="panel-receive" class="hidden flex-1 p-6 flex flex-col max-w-md mx-auto w-full">
    <div class="flex gap-3 mb-6"> 
        <button onclick="receiver.setSrc('environment')" class="flex-1 bg-white border border-slate-100 py-4 rounded-2xl text-[11px] font-bold shadow-sm active:bg-slate-50">é•œå¤´æ‰«æ</button>
        <button onclick="receiver.setSrc('screen')" class="flex-1 bg-white border border-slate-100 py-4 rounded-2xl text-[11px] font-bold shadow-sm active:bg-slate-50">æ•æ‰å±å¹•</button>
    </div>
    
    <div class="preview-box shadow-2xl">
        <div id="cam-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-600 gap-3">
            <span class="text-4xl">ğŸ“·</span>
            <span class="text-[10px] font-bold tracking-widest text-slate-400">è¯·å¼€å¯æ‰«ææº</span>
        </div>
        <video id="rv" autoplay playsinline class="hidden"></video>
        <canvas id="rc" class="absolute inset-0 w-full h-full object-cover"></canvas>
        <div class="scanning-line"></div>
        <div class="absolute inset-0 grid grid-cols-2 grid-rows-2 pointer-events-none">
            <div id="q-tl" class="border-r border-b border-white/10"></div>
            <div id="q-tr" class="border-b border-white/10"></div>
            <div id="q-bl" class="border-r border-white/10"></div>
            <div id="q-br" class="border-white/10"></div>
        </div>
    </div>

    <div id="rsc" class="mt-6 bg-white p-6 rounded-3xl shadow-xl hidden">
        <div id="rpv">
            <div class="flex justify-between items-start mb-4">
                <div class="flex-1 min-w-0 pr-4">
                    <h3 id="rn" class="text-sm font-black truncate text-slate-800">--</h3>
                    <div class="flex items-center gap-2">
                        <p id="rs" class="text-[10px] text-slate-400 font-mono"></p>
                        <button onclick="receiver.cancel()" class="text-[10px] text-red-400 font-bold hover:text-red-600 uppercase tracking-tighter">å–æ¶ˆæ¥æ”¶</button>
                    </div>
                </div>
                <div id="re" class="text-xs font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-lg">--:--</div>
            </div>
            <div class="h-3 bg-slate-100 rounded-full overflow-hidden mb-3">
                <div id="rb" class="h-full bg-indigo-500 w-0 transition-all duration-300"></div>
            </div>
            <div class="flex justify-between items-center text-[10px] font-black">
                <span class="text-slate-400 uppercase">è¿›åº¦: <span id="rp" class="text-indigo-600">0</span>%</span>
                <span id="stat-info" class="text-slate-400">RANK: 0</span>
            </div>
        </div>
        
        <div id="rcv" class="hidden text-center space-y-4">
            <div class="py-4">
                <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-2 text-2xl">âœ“</div>
                <h4 class="text-lg font-black text-slate-800">æ¥æ”¶æˆåŠŸ</h4>
                <p id="fin-info" class="text-[10px] text-slate-400 font-medium"></p>
            </div>
            <button id="bd" class="w-full py-4 bg-green-600 text-white rounded-2xl font-black shadow-lg">ä¿å­˜æ–‡ä»¶</button>
        </div>
    </div>
</main>

<script>
const Utils = {
    fS: (b) => b < 1024 ? b + ' B' : b < 1048576 ? (b/1024).toFixed(1) + ' KB' : (b/1048576).toFixed(1) + ' MB',
    fT: (s) => isFinite(s) && s >= 0 ? `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}` : "--:--",
    PRNG: (s) => () => { s = (s * 16807) % 2147483647; return (s - 1) / 2147483646; },
    u2b: (u8) => btoa(String.fromCharCode.apply(null, u8)),
    b2u: (str) => {
        const b = atob(str);
        const u = new Uint8Array(b.length);
        for (let i = 0; i < b.length; i++) u[i] = b.charCodeAt(i);
        return u;
    },
    xor: (a, b) => { for (let i = 0; i < a.length; i++) a[i] ^= b[i]; }
};

const sender = {
    data: null, chunks: [], timer: null, qrs: [], pC: 0, fps: 10, cS: 180, tid: null,
    init: () => {
        ['qr1','qr2','qr3','qr4'].forEach(id => {
            sender.qrs.push(new QRious({element:document.getElementById(id), size:400, level:'L', padding: 0}));
        });
    },
    toggleMode: (m) => {
        document.getElementById('m-file').className = m==='file' ? "text-xs font-black text-indigo-600 border-b-2 border-indigo-600 pb-2" : "text-xs font-black text-slate-400 pb-2";
        document.getElementById('m-text').className = m==='text' ? "text-xs font-black text-indigo-600 border-b-2 border-indigo-600 pb-2" : "text-xs font-black text-slate-400 pb-2";
        document.getElementById('area-file').classList.toggle('hidden', m!=='file');
        document.getElementById('area-text').classList.toggle('hidden', m!=='text');
        sender.reset();
    },
    handleFile: (f) => {
        if(!f) return; sender.m = { n: f.name, s: f.size };
        const r = new FileReader(); r.onload = (e) => { sender.data = new Uint8Array(e.target.result); sender.prep(); };
        r.readAsArrayBuffer(f);
    },
    handleText: () => {
        const t = document.getElementById('ti').value; if(!t) return;
        sender.data = new TextEncoder().encode(t);
        sender.m = { n: "Note_"+Date.now().toString().slice(-4)+".txt", s: sender.data.length };
        sender.prep();
    },
    prep: () => {
        sender.stop();
        sender.chunks = [];
        for(let i=0; i<sender.data.length; i+=sender.cS) {
            let b = sender.data.slice(i, i+sender.cS);
            if(b.length < sender.cS) { let t = new Uint8Array(sender.cS); t.set(b); b = t; }
            sender.chunks.push(b);
        }
        document.getElementById('si').classList.remove('hidden');
        document.getElementById('sn').innerText = sender.m.n;
        document.getElementById('ss').innerText = Utils.fS(sender.m.s);
        document.getElementById('bs').disabled = false;
        document.getElementById('sender-ctrl').classList.remove('hidden');
        document.getElementById('mc').classList.add('opacity-10', 'grayscale', 'blur-[2px]');
    },
    start: () => {
        document.querySelectorAll('input[type="range"]').forEach(i => i.disabled = true);
        sender.tid = Math.random().toString(36).slice(-3);
        document.getElementById('mc').classList.remove('opacity-10', 'grayscale', 'blur-[2px]');
        document.getElementById('sender-ctrl').classList.add('hidden');
        document.getElementById('btn-stop').classList.remove('hidden');
        sender.timer = setInterval(sender.tick, 1000/sender.fps);
    },
    stop: () => { 
        document.querySelectorAll('input[type="range"]').forEach(i => i.disabled = false);
        clearInterval(sender.timer); 
        sender.timer = null; 
        document.getElementById('sender-ctrl').classList.remove('hidden');
        document.getElementById('btn-stop').classList.add('hidden');
        document.getElementById('mc').classList.add('opacity-10', 'grayscale', 'blur-[2px]');
    },
    reset: () => { 
        sender.stop(); sender.data = null; 
        document.getElementById('si').classList.add('hidden'); 
        document.getElementById('bs').disabled = true; 
    },
    getDegree: (L, rng) => {
        const p = rng();
        if (p < 0.4) return 1;
        if (p < 0.7) return 2;
        if (p < 0.9) return Math.min(L, Math.floor(rng() * 10) + 3);
        return Math.min(L, Math.floor(rng() * L * 0.5) + 2);
    },
    tick: () => {
        const L = sender.chunks.length;
        const meta = encodeURIComponent(sender.m.n) + ":" + sender.m.s;
        for(let i=0; i<4; i++){
            const s = Math.floor(Math.random()*1000000);
            const rng = Utils.PRNG(s);
            const d = sender.getDegree(L, rng);
            const idxs = []; while(idxs.length < d){ let x = Math.floor(rng()*L); if(!idxs.includes(x)) idxs.push(x); }
            const xorBuf = new Uint8Array(sender.cS);
            idxs.forEach(idx => Utils.xor(xorBuf, sender.chunks[idx]));
            sender.qrs[i].value = `${sender.tid}|${s}|${L}|${Utils.u2b(xorBuf)}|${meta}`;
        }
    }
};

const receiver = {
    v: document.getElementById('rv'), c: document.getElementById('rc'), sc: false, solved: {}, coll: new Set(), q: [],
    init: () => { receiver.ctx = receiver.c.getContext('2d', {willReadFrequently:true}); },
    setSrc: async (mode) => {
        receiver.reset(); receiver.init();
        try {
            const stream = (mode === 'screen') 
                ? await navigator.mediaDevices.getDisplayMedia({ video: true })
                : await navigator.mediaDevices.getUserMedia({ video: { facingMode: mode, width: {ideal: 1280} } });
            receiver.v.srcObject = stream;
            receiver.s = stream;
            receiver.sc = true;
            document.getElementById('cam-placeholder').classList.add('hidden');
            requestAnimationFrame(receiver.loop);
        } catch(e) { alert("å¯åŠ¨å¤±è´¥: " + e.message); }
    },
    reset: () => { 
        receiver.sc = false; if(receiver.s) receiver.s.getTracks().forEach(t => t.stop()); 
        receiver.tid = null; receiver.coll.clear(); receiver.solved = {}; receiver.q = []; 
        document.getElementById('rsc').classList.add('hidden'); 
        document.getElementById('cam-placeholder').classList.remove('hidden');
        const ctx = receiver.c.getContext('2d'); ctx.clearRect(0,0,receiver.c.width,receiver.c.height);
    },
    loop: () => {
        if(!receiver.sc) return;
        if(receiver.v.readyState === receiver.v.HAVE_ENOUGH_DATA){
            const size = Math.min(receiver.v.videoWidth, receiver.v.videoHeight);
            receiver.c.width = receiver.c.height = size;
            const sx = (receiver.v.videoWidth - size) / 2, sy = (receiver.v.videoHeight - size) / 2;
            receiver.ctx.drawImage(receiver.v, sx, sy, size, size, 0, 0, size, size);
            const w = size, h = size, mX = w/2, mY = h/2;
            const regs = [
                {id:'full',x:w*0.1,y:h*0.1,w:w*0.8,h:h*0.8},
                {id:'q-tl',x:0,y:0,w:mX,h:mY},{id:'q-tr',x:mX,y:0,w:mX,h:mY},
                {id:'q-bl',x:0,y:mY,w:mX,h:mY},{id:'q-br',x:mX,y:mY,w:mX,h:mY}
            ];
            regs.forEach(r => {
                const d = receiver.ctx.getImageData(r.x, r.y, r.w, r.h);
                const qr = jsQR(d.data, d.width, d.height, { inversionAttempts: "dontInvert" });
                if(qr) {
                    if(r.id !== 'full') {
                        const el = document.getElementById(r.id);
                        el.style.backgroundColor = 'rgba(99, 102, 241, 0.4)';
                        setTimeout(() => el.style.backgroundColor = 'transparent', 200);
                    }
                    receiver.parse(qr.data);
                }
            });
        }
        requestAnimationFrame(receiver.loop);
    },
    parse: (str) => {
        const p = str.split('|'); if(p.length < 5) return;
        const [tid, sStr, tStr, b64, meta] = p;
        const s = parseInt(sStr), L = parseInt(tStr);
        if(receiver.tid !== tid){
            receiver.tid = tid; receiver.tL = L; receiver.sT = Date.now();
            const [n, sz] = meta.split(':'); receiver.fN = decodeURIComponent(n); receiver.fS = parseInt(sz);
            receiver.coll.clear(); receiver.solved = {}; receiver.q = [];
            document.getElementById('rsc').classList.remove('hidden');
            document.getElementById('rn').innerText = receiver.fN;
            document.getElementById('rs').innerText = Utils.fS(receiver.fS);
            document.getElementById('rcv').classList.add('hidden');
            document.getElementById('rpv').classList.remove('hidden');
        }
        if(receiver.coll.has(s)) return; receiver.coll.add(s);
        receiver.processPacket(s, L, Utils.b2u(b64));
    },
    processPacket: (s, L, data) => {
        const rng = Utils.PRNG(s);
        const p = rng();
        let d = p < 0.4 ? 1 : p < 0.7 ? 2 : p < 0.9 ? Math.min(L, Math.floor(rng()*10)+3) : Math.min(L, Math.floor(rng()*L*0.5)+2);
        const idxs = []; while(idxs.length < d){ let x = Math.floor(rng()*L); if(!idxs.includes(x)) idxs.push(x); }
        let curData = new Uint8Array(data), curIdxs = idxs.sort((a,b) => a-b);
        for (let i = 0; i < curIdxs.length; i++) {
            const idx = curIdxs[i];
            if (receiver.solved[idx]) { Utils.xor(curData, receiver.solved[idx]); curIdxs.splice(i, 1); i--; }
        }
        if (curIdxs.length === 0) return;
        for (let item of receiver.q) {
            if (curIdxs.length === 0) break;
            if (item.idxs[0] === curIdxs[0]) { Utils.xor(curData, item.u8); curIdxs = receiver.xorIdxs(curIdxs, item.idxs); }
            else if (item.idxs[0] > curIdxs[0]) break;
        }
        if (curIdxs.length > 0) {
            const newNode = {idxs: curIdxs, u8: curData};
            receiver.q.push(newNode); receiver.q.sort((a, b) => a.idxs[0] - b.idxs[0]);
            for (let i = 0; i < receiver.q.length - 1; i++) {
                if (receiver.q[i].idxs.includes(curIdxs[0])) { Utils.xor(receiver.q[i].u8, curData); receiver.q[i].idxs = receiver.xorIdxs(receiver.q[i].idxs, curIdxs); }
            }
        }
        receiver.q = receiver.q.filter(it => {
            if (it.idxs.length === 1) { receiver.solved[it.idxs[0]] = it.u8; return false; }
            return it.idxs.length > 0;
        });
        receiver.updateUI();
    },
    xorIdxs: (a, b) => {
        const s = new Set(a); b.forEach(x => s.has(x) ? s.delete(x) : s.add(x));
        return Array.from(s).sort((n1, n2) => n1 - n2);
    },
    updateUI: () => {
        const done = Object.keys(receiver.solved).length;
        const pct = Math.floor((done / receiver.tL) * 100);
        document.getElementById('rb').style.width = pct + '%';
        document.getElementById('rp').innerText = pct;
        document.getElementById('stat-info').innerText = `RANK: ${done}/${receiver.tL}`;
        const elap = (Date.now() - receiver.sT) / 1000;
        if(elap > 0.5 && done > 0) {
            const remain = (receiver.tL - done) / (done / elap);
            document.getElementById('re').innerText = Utils.fT(remain);
        }
        if(done >= receiver.tL) receiver.fin();
    },
    fin: () => {
        receiver.sc = false;
        const elap = ((Date.now() - receiver.sT) / 1000).toFixed(1);
        document.getElementById('rpv').classList.add('hidden');
        document.getElementById('rcv').classList.remove('hidden');
        document.getElementById('fin-info').innerText = `æ–‡ä»¶å: ${receiver.fN} | å¤§å°: ${Utils.fS(receiver.fS)} | è€—æ—¶: ${elap}s`;
        
        const res = new Uint8Array(receiver.fS);
        for(let i = 0; i < receiver.tL; i++) {
            const start = i * sender.cS; 
            if(start < receiver.fS) {
                const bytesRemaining = receiver.fS - start;
                const len = Math.min(sender.cS, bytesRemaining);
                if (receiver.solved[i]) {
                    res.set(receiver.solved[i].slice(0, len), start);
                }
            }
        }
        const blob = new Blob([res], {type:'application/octet-stream'});
        document.getElementById('bd').onclick = () => {
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = receiver.fN; a.click();
        };
    },
    cancel: () => {
        if (confirm("ç¡®å®šè¦å–æ¶ˆå½“å‰æ–‡ä»¶çš„æ¥æ”¶å—ï¼Ÿ")) {
            receiver.reset();
            // é¢å¤–ç¡®ä¿ UI çŠ¶æ€å®Œå…¨éšè—
            document.getElementById('rsc').classList.add('hidden');
            console.log("æ¥æ”¶å·²æ‰‹åŠ¨å–æ¶ˆ");
        }
    },
};

const app = {
    switchTab: (t) => {
        document.getElementById('panel-send').classList.toggle('hidden', t!=='send');
        document.getElementById('panel-receive').classList.toggle('hidden', t!=='receive');
        document.getElementById('tab-s').className = t==='send' ? "flex-1 py-1.5 rounded-xl text-xs font-bold transition-all tab-active" : "flex-1 py-1.5 rounded-xl text-xs font-bold transition-all text-slate-500";
        document.getElementById('tab-r').className = t==='receive' ? "flex-1 py-1.5 rounded-xl text-xs font-bold transition-all tab-active" : "flex-1 py-1.5 rounded-xl text-xs font-bold transition-all text-slate-500";
        if(t === 'receive') receiver.init(); else receiver.reset();
    },
    toggleFullscreen: () => {
        const container = document.getElementById('mc');
        // åªæœ‰æ­£åœ¨æ’­æ”¾æ—¶æ‰å…è®¸æ”¾å¤§ï¼Œé¿å…ç©ºå†…å®¹å…¨å±
        if (sender.timer || container.classList.contains('matrix-fullscreen')) {
            container.classList.toggle('matrix-fullscreen');
        }
    }
};
sender.init();
</script>
</body>
</html>
